<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏ô‡∏ù‡∏±‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-900 p-6">

    <div class="max-w-2xl mx-auto bg-white shadow-lg p-6 rounded-lg">
        <h1 class="text-2xl font-bold text-center mb-4">üè° ‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏ô‡∏ù‡∏±‡∏ô</h1>
        
        <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ -->
        <div class="space-y-4">
            <label>üí∞ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ (‡∏ö‡∏≤‡∏ó)</label>
            <input id="loanAmount" type="number" class="w-full p-2 border rounded" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1000000">

            <label>üìà ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ (%)</label>
            <input id="interestRate" type="number" class="w-full p-2 border rounded" placeholder="‡πÄ‡∏ä‡πà‡∏ô 5">

            <label>üìÖ ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡πà‡∏≠‡∏ô (‡∏õ‡∏µ)</label>
            <input id="loanTerm" type="number" class="w-full p-2 border rounded" placeholder="‡πÄ‡∏ä‡πà‡∏ô 20">

            <button onclick="calculateLoan()" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600 transition">
                ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
            </button>
        </div>

        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì -->
        <div id="result" class="mt-6 text-center text-lg hidden"></div>

        <!-- ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ -->
        <div id="remainingBalance" class="mt-6 text-center text-lg font-bold text-red-600"></div>

        <!-- ‡∏Å‡∏£‡∏≤‡∏ü -->
        <canvas id="loanChart" class="mt-6"></canvas>

        <!-- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
        <div class="mt-6">
            <h2 class="text-xl font-bold">üí≥ ‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î</h2>
            <input id="paymentDate" type="date" class="w-full p-2 border rounded mt-2">
            <input id="paymentAmount" type="number" class="w-full p-2 border rounded mt-2" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
            <select id="paymentStatus" class="w-full p-2 border rounded mt-2">
                <option value="regular">‡∏ä‡∏≥‡∏£‡∏∞‡∏õ‡∏Å‡∏ï‡∏¥</option>
                <option value="extra">‡πÇ‡∏õ‡πä‡∏∞</option>
            </select>
            <button onclick="addPayment()" class="w-full bg-green-500 text-white py-2 rounded mt-2 hover:bg-green-600 transition">
                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            </button>
        </div>

        <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
        <div id="paymentHistory" class="mt-6"></div>

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
        <button onclick="clearData()" class="w-full bg-red-500 text-white py-2 rounded mt-4 hover:bg-red-600 transition">
            ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </button>

    </div>

    <script>
    let loanData = JSON.parse(localStorage.getItem("loanData")) || {};
    let payments = JSON.parse(localStorage.getItem("payments")) || [];
    let chart;

    function calculateLoan() {
        let amount = parseFloat(document.getElementById("loanAmount").value);
        let rate = parseFloat(document.getElementById("interestRate").value) / 100 / 12;
        let months = parseFloat(document.getElementById("loanTerm").value) * 12;

        if (isNaN(amount) || isNaN(rate) || isNaN(months)) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô!");
            return;
        }

        let monthlyPayment = (amount * rate) / (1 - Math.pow(1 + rate, -months));
        loanData = { amount, rate, months, monthlyPayment };
        localStorage.setItem("loanData", JSON.stringify(loanData));

        document.getElementById("result").innerHTML = `üíµ ‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${monthlyPayment.toFixed(2)} ‡∏ö‡∏≤‡∏ó`;
        document.getElementById("result").classList.remove("hidden");

        updateChart();
        updateRemainingBalance();
    }

    function addPayment() {
        let date = document.getElementById("paymentDate").value;
        let amount = parseFloat(document.getElementById("paymentAmount").value);
        let status = document.getElementById("paymentStatus").value;

        if (!date || isNaN(amount)) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô!");
            return;
        }

        let interest = loanData.amount * loanData.rate;
        let principal = amount - interest;

        if (status === "extra") {
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô "‡πÇ‡∏õ‡πä‡∏∞" ‡∏à‡∏∞‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            principal = amount;
            interest = 0; // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢
        }

        loanData.amount -= principal;
        payments.push({ date, amount, status, principal, interest });
        localStorage.setItem("loanData", JSON.stringify(loanData));
        localStorage.setItem("payments", JSON.stringify(payments));

        updateChart();
        displayPayments();
        updateRemainingBalance();
    }

    function updateRemainingBalance() {
        let balanceDiv = document.getElementById("remainingBalance");
        balanceDiv.innerHTML = `üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${loanData.amount.toFixed(2)} ‡∏ö‡∏≤‡∏ó`;
    }

    function updateChart() {
        let labels = [];
        let data = [];
        let remaining = loanData.amount;

        for (let i = 0; i < loanData.months; i++) {
            labels.push(`‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${i + 1}`);
            remaining -= loanData.monthlyPayment;
            data.push(remaining < 0 ? 0 : remaining);
        }

        if (chart) chart.destroy();

        let ctx = document.getElementById("loanChart").getContext("2d");
        chart = new Chart(ctx, {
            type: "line",
            data: {
                labels,
                datasets: [{
                    label: "‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠",
                    data,
                    borderColor: "#2563eb",
                    fill: false,
                    tension: 0.1
                }]
            },
            options: { animation: { duration: 1500 } }
        });
    }

    function displayPayments() {
        let historyDiv = document.getElementById("paymentHistory");
        historyDiv.innerHTML = `<h2 class="text-xl font-bold">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>`;
        
        payments.forEach((p, index) => {
            historyDiv.innerHTML += `
                <p>üìÖ ${p.date} - üí∞ ${p.amount} ‡∏ö‡∏≤‡∏ó (${p.status === "extra" ? "‡πÇ‡∏õ‡πä‡∏∞" : "‡∏õ‡∏Å‡∏ï‡∏¥"})</p>
                <p>üîª ‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏•‡∏î‡∏•‡∏á: ${p.principal.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                <p>üí∏ ‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢: ${p.interest.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                <hr class="my-2">
            `;
        });
    }

    function clearData() {
        if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) {
            localStorage.clear();
            loanData = {};
            payments = [];
            document.getElementById("paymentHistory").innerHTML = "";
            document.getElementById("remainingBalance").innerHTML = "";
            document.getElementById("result").classList.add("hidden");
            if (chart) chart.destroy();
            alert("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
        }
    }

    window.onload = function () {
        if (loanData.amount) {
            calculateLoan();
            updateRemainingBalance();
        }
        displayPayments();
    };
</script>
</body>
</html>
