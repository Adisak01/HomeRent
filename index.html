<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ö‡πâ‡∏≤‡∏ô</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            background: #f8f9fa;
            text-align: center;
        }
        input, button {
            width: 90%;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 16px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 18px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .history {
            margin-top: 20px;
            text-align: left;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        canvas {
            max-width: 100%;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h2>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏ö‡πâ‡∏≤‡∏ô üè°</h2>
    <input type="number" id="loanAmount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ (‡∏ö‡∏≤‡∏ó)">
    <input type="number" id="interestRate" placeholder="‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ï‡πà‡∏≠‡∏õ‡∏µ (%)">
    <input type="number" id="loanYears" placeholder="‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏π‡πâ (‡∏õ‡∏µ)">
    <button onclick="calculateMortgage()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
    <p id="monthlyPayment">‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: - ‡∏ö‡∏≤‡∏ó</p>
    <p id="remainingBalance">‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: - ‡∏ö‡∏≤‡∏ó</p>
    <canvas id="loanChart"></canvas>
    
    <h3>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô</h3>
    <input type="date" id="paymentDate">
    <input type="number" id="paymentAmount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)">
    <button onclick="recordPayment()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô</button>
    <div class="history" id="paymentHistory">
        <h4>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô</h4>
        <ul id="historyList"></ul>
    </div>

    <script>
        let payments = JSON.parse(localStorage.getItem("payments")) || [];
        let remainingBalance = parseFloat(localStorage.getItem("remainingBalance")) || 0;

        function calculateMortgage() {
            let principal = parseFloat(document.getElementById("loanAmount").value);
            let annualRate = parseFloat(document.getElementById("interestRate").value);
            let years = parseFloat(document.getElementById("loanYears").value);
            
            if (isNaN(principal) || isNaN(annualRate) || isNaN(years) || principal <= 0 || annualRate < 0 || years <= 0) {
                document.getElementById("monthlyPayment").innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!";
                return;
            }

            let monthlyRate = (annualRate / 100) / 12;
            let numPayments = years * 12;
            let monthlyPayment = (principal * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -numPayments));
            document.getElementById("monthlyPayment").innerText = `‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${monthlyPayment.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
            
            remainingBalance = principal;
            localStorage.setItem("remainingBalance", remainingBalance);
            document.getElementById("remainingBalance").innerText = `‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${remainingBalance.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
            
            let loanData = [];
            for (let i = 1; i <= years; i++) {
                for (let j = 0; j < 12; j++) {
                    let interest = remainingBalance * monthlyRate;
                    let principalPayment = monthlyPayment - interest;
                    remainingBalance -= principalPayment;
                }
                loanData.push({ year: i, balance: Math.max(remainingBalance, 0) });
            }
            updateChart(loanData);
        }

        function recordPayment() {
            let date = document.getElementById("paymentDate").value;
            let amount = parseFloat(document.getElementById("paymentAmount").value);
            
            if (!date || isNaN(amount) || amount <= 0) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!");
                return;
            }
            
            remainingBalance -= amount;
            if (remainingBalance < 0) remainingBalance = 0;
            localStorage.setItem("remainingBalance", remainingBalance);
            document.getElementById("remainingBalance").innerText = `‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${remainingBalance.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
            
            payments.push({ date, amount });
            localStorage.setItem("payments", JSON.stringify(payments));
            updateHistory();
        }

        function updateHistory() {
            let historyList = document.getElementById("historyList");
            historyList.innerHTML = "";
            payments.forEach(payment => {
                let listItem = document.createElement("li");
                listItem.textContent = `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${payment.date} - ‡∏à‡πà‡∏≤‡∏¢ ${payment.amount.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
                historyList.appendChild(listItem);
            });
        }

        function updateChart(data) {
            let ctx = document.getElementById("loanChart").getContext("2d");
            if (window.loanChartInstance) {
                window.loanChartInstance.destroy();
            }
            window.loanChartInstance = new Chart(ctx, {
                type: "line",
                data: {
                    labels: data.map(d => `‡∏õ‡∏µ ${d.year}`),
                    datasets: [{
                        label: "‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠",
                        data: data.map(d => d.balance),
                        borderColor: "#FF5733",
                        fill: false
                    }]
                }
            });
        }

        document.getElementById("remainingBalance").innerText = `‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${remainingBalance.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
        updateHistory();
    </script>
</body>
</html>
